---
import MainLayout from '../../layouts/MainLayout.astro';
import PhotoGrid from '../../components/PhotoGrid.astro';
import { getCollections, getImages } from '../../data/imageStore';

// Define allCollection with the same structure as other collections
const allCollection = {
	id: undefined,
	name: 'All',
	pdfUrl: undefined // Add this line to match the interface
};

const collections = [allCollection, ...(await getCollections())];
const { collection } = Astro.params;
const images = await getImages(collection ? { collection } : {});
const base = import.meta.env.BASE_URL;

// Find the current collection and its PDF
const currentCollection = collections.find(col => col.id === collection);
const collectionPdf = currentCollection?.pdfUrl;

export const getStaticPaths = async () => {
	return [{ id: undefined }, ...(await getCollections())].map((collection) => {
		return {
			params: { collection: collection.id },
		};
	});
};
---

<MainLayout>
	<section class="py-16 pt-24">
		<div class="container-custom">
			<div class="mb-16 text-center">
				<h1 class="text-4xl md:text-5xl font-bold mb-4">Gallery</h1>
				<p class="text-gray-600 max-w-xl mx-auto">Explore my collection of photographic works</p>
			</div>

			<!-- Collection Navigation -->
			<div class="flex flex-col items-center mb-12 gap-6">
				<div class="flex flex-wrap gap-2 justify-center">
					{
						collections.map((collectionBtn) => (
							<a 
								href={`${base}/collections/${collectionBtn.id ? collectionBtn.id : ''}`}
								class="block transition-transform hover:scale-105"
							>
								<div
									class={`px-6 py-3 rounded-full border-2 font-medium transition-all duration-300 ${
										collectionBtn.id === collection
											? 'border-blue-600 bg-blue-600 text-white shadow-lg'
											: 'border-gray-300 text-gray-700 hover:border-blue-400 hover:text-blue-600 bg-white'
									}`}
								>
									{collectionBtn.name}
								</div>
							</a>
						))
					}
				</div>

				<!-- Collection PDF download button -->
				{collectionPdf && (
					<div class="text-center animate-fade-in">
						<a 
							href={collectionPdf} 
							download
							class="download-pdf-btn inline-flex items-center justify-center bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-8 py-4 rounded-xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1"
						>
							<svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
							</svg>
							Download {currentCollection?.name} Collection
						</a>
						<p class="text-sm text-gray-500 mt-2">High-quality portfolio ready for viewing</p>
					</div>
				)}
			</div>

			<!-- Photo Grid -->
			<PhotoGrid images={images} />
		</div>
	</section>

	<style>
		.animate-fade-in {
			animation: fadeIn 0.6s ease-out;
		}
		
		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(-10px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}
	</style>
</MainLayout>